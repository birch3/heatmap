<!DOCTYPE html>
<html lang="en">
<!--<script src="./mapindex.js"></script>-->

<head>
    <meta charset="UTF-8">
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>


    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        html,
        body {
            height: 100%;
            margin: 0;
        }

        #map {
            height: 100vh;
            /* 100% of the viewport height */
            width: 100vw;
            /* 100% of the viewport width */
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <!--Map part-->
    <script>
        const csvData = `City,Latitude,Longitude,News_Event,Starting_Date,End_Date,URL,Topic,Severity
Mogadishu,2.046934,45.318161,Severe flooding displaces thousands,2023-11-08,2023-11-15,example.com/mogadishu-flooding,Natural Disaster,High
Hargeisa,9.562389,44.077011,Armed clashes between local militias,2024-02-15,2024-02-20,example.com/hargeisa-clashes,Violence,High
Berbera,10.438621,45.0134,Earthquake causes significant damage,2023-05-22,2023-05-23,example.com/berbera-earthquake,Natural Disaster,High
`;
       
        const map = L.map('map').setView([5, 45], 8);
        const tiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);
        const TopicIcon = L.Icon.extend({
            options: {
                iconSize: [38, 50],
                shadowSize: [50, 64],
                iconAnchor: [22, 94],
                popupAnchor: [-3, -95]
            }
        });
        function AddPin(row,topicIcon) {
            if (!isNaN(row.Latitude) && !isNaN(row.Longitude) && row.URL) {
                L.marker([row.Latitude, row.Longitude], { icon: topicIcon }).addTo(map)
                    .bindPopup(`<strong>Event:</strong> ${row.News_Event}<br>
                                <strong>Start Date:</strong> ${row.Starting_Date}<br>
                                <strong>End Date:</strong> ${row.End_Date}<br>
                                <strong>URL:</strong> <a href="http://${row.URL}" target="_blank">${row.URL}</a><br>
                                <strong>Topic:</strong> ${row.Topic}<br>
                                <strong>Severity:</strong> ${row.Severity}`).openPopup();
            } else {
                console.error(`Invalid data: ${row.Latitude}, ${row.Longitude}, ${row.URL}`);
            }
        }

        fetch('data.csv')
            .then(response=>response.text())
            .then(csvData=>{
        Papa.parse(csvData, {
            header: true,
            complete: function (results) {
                results.data.forEach(row => {
                    if (!map) {
                        console.log("map object not initialized")
                        return;
                    }
                    const lat = parseFloat(row.Latitude);
                    const lon = parseFloat(row.Longitude);
                    const topic = String(row.Topic);
                    let topicIcon;


                    const iconUrl = {
                        "Natural Disaster": "src/NaturalDisaster.png",
                        "Violence": "src/Violence.png"
                    };

                    topicIcon = iconUrl[topic] ? new TopicIcon({ iconUrl: iconUrl[topic] }) : null;

                    if (topicIcon) {
                        console.log(topic);
                        AddPin(row,topicIcon);
                    } else {
                        console.log("Not setted type");
                        console.log(topic);
                    }



                })
            }
        })
    })

    </script>
</body>

</html>